import{c as re,f as P,a as O,u as U,j as e,b as Ee,T as y,G as Z,B as S,r as p,L as oe,d as ae,e as ie,h as Ne,g as Fe,i as _e,A as Ue,k as v,l as De,m as Re,n as Ge,o as V,p as Qe,P as B,q as He,s as ee,t as te,E as qe,F as ze,C as Ve,v as Be,w as Ye,x as w,y as $e,O as We,S as Y,z as le,I as ce,D as de,H as Xe,J as Ke,M as D,K as R,N as Je,Q as Ze,R as et,U as tt,V as ue,W as se,X as he,Y as st,Z as nt,_ as rt,$ as ot,a0 as at}from"./vendor-3a40e17c.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerpolicy&&(a.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?a.credentials="include":o.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(o){if(o.ep)return;o.ep=!0;const a=n(o);fetch(o.href,a)}})();const pe="https://photo.api.dc2.a4sex.net",it="https://userpic.api.dc2.a4sex.net",lt="https://cors.eu.org",G=10*1e3,M={CHATS:"",ACQUAINTANCES:"acquaintances",CHAT:"chat/:interlocutorId"},ge=15,ct="en",Q=(t,s)=>t.target===t.currentTarget&&s(),$=t=>Object.entries(t).forEach(([s,n])=>localStorage.setItem(s,JSON.stringify(n))),dt=(...t)=>t.forEach(s=>localStorage.removeItem(s)),me=t=>{const s={};for(const n in t){const r=t[n],o=JSON.parse(localStorage.getItem(n)??"null",r==="default"?void 0:(a,i)=>r(i));s[n]=o}return s},ut=me({refreshToken:"default",accessToken:"default",login:"default"}),xe=re({name:"auth",initialState:ut,reducers:{updateAccessToken:(t,s)=>{t.accessToken=s.payload},login:(t,s)=>{const{login:n,refresh:r,token:o}=s.payload;t.login=n,t.refreshToken=r,t.accessToken=o},logout:t=>{t.login=null,t.refreshToken=null,t.accessToken=null}}}),{updateAccessToken:ht,login:pt,logout:gt}=xe.actions,H=t=>t.auth.accessToken,W=t=>t.auth.refreshToken,fe=t=>t.auth.login,mt=xe.reducer,xt=P({baseUrl:"https://auth.api.dc2.a4sex.net/api/v1/",method:"post"}),q=t=>async(s,n,r)=>{var i;const o=P({...t,prepareHeaders:(l,{getState:c})=>l.set("Authorization","Bearer "+H(c()))});let a=await o(s,n,r);if(((i=a==null?void 0:a.error)==null?void 0:i.status)===401){const l=await xt({url:"/refresh",body:{token:W(n.getState())}},n,r);if(l.error)return{error:l.error};const c=l.data.token;n.dispatch(ht(c)),$({accessToken:c}),a=await o(s,n,r)}return a},E=O({reducerPath:"photo/api",baseQuery:q({baseUrl:"https://photo.api.dc2.a4sex.net/"}),tagTypes:["Photos"],endpoints:t=>({getPhoto:t.query({query:({alias:s,interlocutorId:n})=>({url:`/sends/${s}`,params:{tid:n}}),transformResponse:s=>({...s.photo,alias:s.photo.copy})}),getUsersPhotos:t.query({query:()=>({url:"/photos"}),transformResponse:s=>s.photos,providesTags:["Photos"]}),uploadPhoto:t.mutation({query:s=>({url:"/upload",method:"post",body:s}),invalidatesTags:["Photos"]})})}),{useLazyGetPhotoQuery:cs,useGetPhotoQuery:ft,useGetUsersPhotosQuery:jt,useUploadPhotoMutation:yt}=E,Ct=({alias:t})=>{const s=U(),n=Number(s.interlocutorId),{data:r,isLoading:o}=ft({alias:t,interlocutorId:n});return!r||o?e.jsx(b,{}):e.jsx("img",{alt:t,src:pe+r._links.origin.href,loading:"lazy",style:{width:"100%"}})},St={locale:ct},Tt=re({name:"settings",initialState:St,reducers:{}}),At=t=>t.settings.locale,It=Tt.reducer,je=Ee,vt={ACQUAINTANCES:{en:"Acquaintances",ru:"Знакомства"},CHATS:{en:"Chats",ru:"Диалоги"},EMPTY_MESSAGES:{en:"No messages",ru:"Нет сообщений"},LOGOUT:{en:"Logout",ru:"Выйти"},MESSAGE:{en:"Message",ru:"Сообщение"},VERIFY_CODE:{en:"Code",ru:"Код"},UPLOADED_PHOTOS:{en:"Uploaded photos",ru:"Загруженные изображения"},EMPTY_UPLOADED_PHOTOS:{en:"No uploaded photos",ru:"Нет загруженных изображений"},CHATS_HISTORY:{en:"Chats history",ru:"История диалогов"},ACQUAINTANCES_HISTORY:{en:"Acquaintances history",ru:"История знакомств"},LOGIN:{en:"Login",ru:"Логин"},PASSWORD:{en:"Password",ru:"Пароль"},LOGIN_TO_ACCOUNT:{en:"Login to account",ru:"Войти в аккаунт"},LOGIN_BUTTON:{en:"Login",ru:"Войти"},REGISTER_BUTTON:{en:"Register",ru:"Зарегистрироваться"},ONLINE:{en:"Online",ru:"Онлайн"},OFFLINE:{en:"Offline",ru:"Оффлайн"}},m=({id:t})=>{const s=je(At),n=vt;return e.jsx(e.Fragment,{children:n[t][s]??n[t].en})},bt=({data:t,isLoading:s,onPhotoClick:n})=>s?e.jsx(b,{}):!t||!t.length?e.jsx(y,{variant:"h4",textAlign:"center",mb:2,children:e.jsx(m,{id:"EMPTY_UPLOADED_PHOTOS"})}):e.jsxs(e.Fragment,{children:[e.jsx(y,{variant:"h4",textAlign:"center",mb:2,children:e.jsx(m,{id:"UPLOADED_PHOTOS"})}),e.jsx(Z,{container:!0,spacing:2,children:t.map(r=>e.jsx(Z,{item:!0,xs:6,sm:4,md:3,children:e.jsx(S,{sx:{position:"relative",width:"100%",pb:"100%",cursor:"pointer"},onClick:()=>n&&n(r.alias),children:e.jsx("img",{src:pe+r._links.origin.href,alt:r.alias,loading:"lazy",style:{position:"absolute",width:"100%",height:"100%",objectFit:"cover"}})})},r.id))})]}),A=O({reducerPath:"mailer/api",baseQuery:P({baseUrl:lt+"/https://freedom-sex.com/mailer/",prepareHeaders:(t,{getState:s})=>{t.set("Authorization","Bearer "+W(s())),t.set("X-Requested-With","XMLHttpRequest")}}),tagTypes:["Status"],endpoints:t=>({sendData:t.mutation({query:s=>({url:"/post",method:"post",body:s})}),getStatus:t.query({query:()=>"/status",providesTags:["Status"]}),checkMessages:t.mutation({query:()=>"/check_message",onQueryStarted:async(s,{dispatch:n,queryFulfilled:r})=>{const o=n(A.util.updateQueryData("getStatus",void 0,a=>{a.message=8}));try{await r}catch{o.undo()}},invalidatesTags:["Status"]}),checkContacts:t.mutation({query:()=>"/check_contact",onQueryStarted:async(s,{dispatch:n,queryFulfilled:r})=>{const o=n(A.util.updateQueryData("getStatus",void 0,a=>{a.contact=8}));try{await r}catch{o.undo()}},invalidatesTags:["Status"]})})}),{useGetStatusQuery:Lt}=A,wt=q({baseUrl:"https://visit.api.dc2.a4sex.net/api/",prepareHeaders:(t,{getState:s})=>t.set("Authorization","Bearer "+H(s()))}),ne=q({baseUrl:"https://dialog.api.dc2.a4sex.net/api/"}),Ot=(t,s,n)=>{if(n!=null&&n.postVisit&&s.dispatch(I.endpoints.postVisit.initiate()),n!=null&&n.addUserId){const r=fe(s.getState());if(!r)return{error:{status:400,statusText:"Bad Request",data:"No user ID received"}};const o=typeof t=="string"?{url:t,params:{userId:r}}:{...t,params:{...t.params,userId:r}};return ne(o,s,n)}return ne(t,s,n)},I=O({reducerPath:"dialog/api",baseQuery:Ot,refetchOnMountOrArgChange:!0,tagTypes:["Messages"],endpoints:t=>({getAcquaints:t.query({queryFn:(s,{dispatch:n},r,o)=>(n(A.endpoints.checkContacts.initiate()),o({url:"/contact_initials",params:{page:s}})),extraOptions:{addUserId:!0,postVisit:!0}}),getChats:t.query({queryFn:async(s,{dispatch:n,getState:r},o,a)=>{n(A.endpoints.checkMessages.initiate());const i=await a({url:"/contact_intimates",params:{page:s}});if(i!=null&&i.error)return{error:i.error};let l;const c=I.endpoints.getChats.select()(r()).data;c?l=c.reduce((u,x)=>({...u,[x.id]:x}),{}):l=me({readChats:"default"}).readChats;const d=i.data.map(u=>{var T;if(!u.dialog)return u;const x=l==null?void 0:l[u.id],g=new Date((x==null?void 0:x.updated)??0).getTime(),h=new Date(u.updated).getTime(),C=Boolean(((T=x==null?void 0:x.dialog)==null?void 0:T.readed)&&h-g<1e4);return{...u,dialog:{...u.dialog,readed:C}}});return $({readChats:l}),{data:d}},extraOptions:{addUserId:!0,postVisit:!0}}),getMessages:t.query({queryFn:(s,{getState:n},r,o)=>{const a=fe(n())+"";return o({url:`/v1/users/${a}/dialog`,params:{tid:s}})},extraOptions:{postVisit:!0},providesTags:["Messages"]}),sendData:t.mutation({queryFn:(s,n)=>n.dispatch(A.endpoints.sendData.initiate(s)),invalidatesTags:["Messages"]}),postVisit:t.query({queryFn:(s,n,r)=>wt({url:"/visit"},n,r)}),readAcquaint:t.mutation({query:s=>({url:`contact_initials/${s}`,method:"put",body:{unread:!1}}),onQueryStarted:async(s,{dispatch:n,queryFulfilled:r})=>{const o=n(I.util.updateQueryData("getAcquaints",void 0,a=>{const i=a.find(l=>l.id===s);i!=null&&i.dialog&&(i.dialog.readed=!0)}));try{await r}catch{o.undo()}}}),readChat:t.mutation({queryFn:({fromId:s,updated:n},{dispatch:r})=>(r(I.util.updateQueryData("getChats",void 0,o=>{const a=o.find(i=>{var l;return((l=i.dialog)==null?void 0:l.fromId)===s});a&&(a.dialog&&(a.dialog.readed=!0),n&&(a.updated=n))})),{data:null})})})}),{useGetAcquaintsQuery:Mt,useLazyGetAcquaintsQuery:Pt,useGetChatsQuery:kt,useLazyGetChatsQuery:Et,useGetMessagesQuery:Nt,useSendDataMutation:Ft,useReadAcquaintMutation:_t,useReadChatMutation:ye}=I,Ut=()=>{const t=U(),s=Number(t.interlocutorId),{data:n,isLoading:r}=Nt(s,{pollingInterval:G}),[o]=ye();return p.useEffect(()=>()=>{var a;n&&o({fromId:s,updated:(a=n[0])==null?void 0:a.added})},[o,s,n]),r?e.jsx(b,{}):!n||!n.length?e.jsx(y,{variant:"h5",textAlign:"center",children:e.jsx(m,{id:"EMPTY_MESSAGES"})}):e.jsx(oe,{sx:{mb:"120px"},children:n.slice().reverse().map(a=>{var d;const i=new Date(a.added),l=[i.toLocaleTimeString("ru"),i.toLocaleDateString("ru")].join(" "),c=(d=a.message.match(/\[\[IMG:(\w+)/))==null?void 0:d.at(1);return e.jsx(ae,{disablePadding:!0,sx:{...a.fromId!==s&&{justifyContent:"end",textAlign:"right"}},children:e.jsx(ie,{primary:c?e.jsx(Ct,{alias:c}):Ne(a.message),secondary:l,sx:{p:"5px",maxWidth:"80%",borderRadius:"5px",border:"1px solid #dee2e6",wordWrap:"break-word",flexGrow:0}})},a.id)})})},X=({data:t,isLoading:s=!1,handleChatClick:n})=>s?e.jsx(b,{}):!t||!t.length?e.jsx(y,{variant:"h5",textAlign:"center",children:e.jsx(m,{id:"EMPTY_MESSAGES"})}):e.jsx(oe,{children:t.map(({dialog:r,human:o,id:a},i)=>{var l;return e.jsx(Dt,{user:o,userpicSrc:(l=o.userpic)==null?void 0:l.source,message:r==null?void 0:r.message,onClick:()=>{n&&n(t[i])},dimItem:r==null?void 0:r.readed},a)})}),Dt=({user:t,userpicSrc:s,message:n,onClick:r,dimItem:o=!1})=>{var i;const a=()=>r&&r();return e.jsx(ae,{alignItems:"flex-start",disableGutters:!0,disabled:o,children:e.jsxs(Fe,{divider:!0,onClick:a,disableGutters:!0,children:[e.jsx(_e,{children:e.jsx(Ue,{alt:t.name??void 0,src:s&&it+s,sx:{bgcolor:`#${t.id}`.slice(0,-2)},children:(i=t.name)==null?void 0:i.at(0)})}),e.jsx(ie,{disableTypography:!0,primary:e.jsx(J,{userId:t.id,placeHolder:t}),secondary:e.jsx(y,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",color:"text.secondary"},children:n})})]})})},Ce=({Localize:t,getDataFn:s,data:n,isFetching:r,drawButton:o=!0})=>{const[a,i]=p.useState(!1),l=()=>i(!0),c=()=>i(!1);return e.jsxs(e.Fragment,{children:[o&&e.jsx(S,{textAlign:"center",children:e.jsx(v,{variant:"contained",onClick:l,children:e.jsx(t,{})})}),e.jsx(Yt,{open:a,onClose:c,getPageFn:s,isFetching:r,data:n,Localize:t})]})},Rt=De({components:{MuiBottomNavigationAction:{styleOverrides:{root:({ownerState:t})=>({[`&.${Re.selected}`]:{...t.value==="acquaints"&&{color:"#f33"}}})}}}}),Gt=()=>{const t=Ge(),s=V(),n=i=>s(i,{replace:!0}),{data:r}=Lt(void 0,{pollingInterval:G}),[o,a]=p.useState(t.pathname.slice(1).split("/").at(0));return e.jsx(Qe,{theme:Rt,children:e.jsx(B,{sx:{position:"fixed",bottom:0,left:0,right:0},elevation:3,children:e.jsxs(He,{showLabels:!0,value:o,onChange:(i,l)=>a(l),children:[e.jsx(ee,{label:e.jsx(m,{id:"CHATS"}),icon:e.jsx(te,{invisible:!r||r.message===8,variant:"dot",color:"error",children:e.jsx(qe,{})}),value:M.CHATS,onClick:()=>n("/")}),e.jsx(ee,{label:e.jsx(m,{id:"ACQUAINTANCES"}),icon:e.jsx(te,{invisible:!r||r.contact===8,variant:"dot",color:"error",children:e.jsx(ze,{})}),value:M.ACQUAINTANCES,onClick:()=>n("/acquaintances")})]})})})},Qt={small:25,default:50,large:75},b=({disableMargin:t=!1,size:s="default"})=>e.jsx(S,{sx:{textAlign:"center",...!t&&{mt:2}},children:e.jsx(Ve,{size:Qt[s]})}),Ht=t=>e.jsxs(e.Fragment,{children:[e.jsx(K,{...t}),e.jsx(Gt,{})]}),N=O({reducerPath:"auth/api",baseQuery:q({baseUrl:"https://auth.api.dc2.a4sex.net/api/v1/",method:"post"}),endpoints:t=>({login:t.mutation({queryFn:async({captcha:s,...n},{dispatch:r},o,a)=>{const i=await a({url:"/login",body:{...s,...n}});if(i.error)return{error:i.error};const l=i.data;if(l.error)return i;const{token:c,refresh:d}=l;return r(pt({token:c,refresh:d,login:n.login})),$({login:n.login,refreshToken:d,accessToken:c}),i}}),logout:t.mutation({queryFn:(s,{dispatch:n})=>(n(gt()),dt("login","refreshToken","accessToken"),{data:null})})})}),{useLoginMutation:qt,useLogoutMutation:zt}=N,K=({logged:t,children:s=e.jsx(We,{})})=>{const[n]=zt(),r=()=>n();return e.jsxs(e.Fragment,{children:[e.jsx(Be,{}),e.jsx(Ye,{position:"static",sx:{mb:2},children:e.jsx(w,{children:e.jsxs($e,{disableGutters:!0,children:[e.jsx(y,{variant:"h6",noWrap:!0,component:"div",sx:{flexGrow:1},children:"Freedom Chat"}),t&&e.jsx(v,{color:"inherit",tabIndex:-1,onClick:r,children:e.jsx(m,{id:"LOGOUT"})})]})})}),e.jsx(w,{sx:{pb:"100px",position:"relative"},children:s})]})},Se=({multiline:t,onDataSended:s,humanId:n})=>{const[r,o]=p.useState(!1),[a,i]=p.useState(!1),[l,c]=p.useState(""),d=U(),u=Number(d.interlocutorId),[x,{data:g,isLoading:h}]=Ft(),C=({type:f,...k})=>{x({...k,id:n??u})},[L,T]=p.useState({});p.useEffect(()=>{if(g){if(g.error==="need_captcha")return o(!0);o(!1),i(!1),c(""),s&&s()}},[g,s]);const j=()=>{if(!l.length)return;const f={type:"message",mess:l,id:u};T(f),C(f)},be=f=>{f.preventDefault(),j()},Le=f=>{const k={type:"photo",photo:f,id:u};T(k),C(k)},we=()=>i(!0),Oe=()=>i(!1),Me=()=>o(!1),Pe=f=>c(f.currentTarget.value),ke=f=>f.ctrlKey&&f.key==="Enter"&&j();return e.jsxs(e.Fragment,{children:[e.jsxs(Y,{component:"form",direction:"row",width:"100%",onSubmit:be,children:[e.jsxs(le,{size:"small",sx:{flexGrow:1},disabled:h,children:[e.jsx(ce,{htmlFor:"messageInput",children:e.jsx(m,{id:"MESSAGE"})}),e.jsx(de,{label:e.jsx(m,{id:"MESSAGE"}),id:"messageInput",autoComplete:"off",onChange:Pe,value:l,multiline:t,maxRows:3,onKeyDown:ke})]}),l.length?e.jsx(v,{color:"primary",type:"submit",children:e.jsx(Xe,{})}):e.jsx(v,{color:"primary",type:"button",onClick:we,children:e.jsx(Ke,{})})]}),e.jsx(Bt,{open:a,onClose:Oe,onPhotoSubmit:Le}),e.jsx(Te,{open:r,onClose:Me,onSubmit:f=>{C({...L,captcha:f})},refetch:(g==null?void 0:g.error)==="need_captcha"})]})},F=O({reducerPath:"verify/api",baseQuery:P({baseUrl:"https://verify.api.dc2.a4sex.net/api/",method:"get",prepareHeaders:(t,{getState:s})=>{t.set("Authorization","Bearer "+H(s()))}}),endpoints:t=>({getVerify:t.query({queryFn:async(s,n,r,o)=>{var c;const a=await o({url:"/time"});if(a!=null&&a.error)return{error:a.error};let i={data:{}};for(;!((c=i.data)!=null&&c.token);)if(i=await o({url:"/token",method:"post",body:{id:a.data.id}}),i!=null&&i.error)return{error:i.error};const l=await o({url:`/image/${i.data.token}`});return l!=null&&l.error?{error:l.error}:{data:{token:i.data.token,image:"data:image/jpeg;base64,"+l.data.image}}}})})}),{useLazyGetVerifyQuery:Vt}=F,Te=({open:t,onClose:s,onSubmit:n,refetch:r})=>{const[o,{data:a,isFetching:i}]=Vt(),[l,c]=p.useState(""),d=g=>Q(g,s),u=g=>{const h=g.currentTarget.value;isNaN(+h)||h.length>4||(h.length>3&&n({token:(a==null?void 0:a.token)??"",code:+h}),c(h))};p.useEffect(()=>{r&&o(),c("")},[r,o]);const x=p.useCallback(g=>{if(!g)return;const h=g.querySelector("input");h==null||h.focus()},[]);return e.jsx(D,{open:t,onClose:d,children:e.jsx(R,{in:t,children:e.jsxs(B,{component:"form",sx:{borderRadius:5,p:2,position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",outline:0},children:[i&&e.jsx(b,{disableMargin:!0}),!i&&e.jsx("img",{alt:"Verify code",src:a==null?void 0:a.image,style:{display:"block",margin:"0 auto"}}),e.jsxs(le,{size:"small",sx:{mt:1},children:[e.jsx(ce,{htmlFor:"component-outlined",children:e.jsx(m,{id:"VERIFY_CODE"})}),e.jsx(de,{label:e.jsx(m,{id:"VERIFY_CODE"}),id:"component-outlined",autoComplete:"off",onChange:u,value:l,type:"number",ref:x})]})]})})})},Bt=({open:t,onClose:s,onPhotoSubmit:n})=>{const r=jt(),[o]=yt(),a=c=>{c.preventDefault(),c.currentTarget.fileUpload.click()},i=c=>Q(c,s),l=c=>{const d=c.currentTarget.files;if(!(d!=null&&d.length))return;const u=new FormData;u.append("file",d[0]),o(u)};return e.jsx(D,{open:t,onClose:i,closeAfterTransition:!0,children:e.jsx(R,{in:t,children:e.jsx(w,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",height:"80%",outline:0},onClick:i,children:e.jsxs(B,{sx:{p:2,overflowY:"auto",maxHeight:"100%"},children:[e.jsx(bt,{...r,onPhotoClick:n}),e.jsxs(S,{component:"form",onSubmit:a,sx:{position:"sticky",bottom:0,textAlign:"end"},children:[e.jsx("input",{hidden:!0,type:"file",name:"fileUpload",multiple:!1,accept:"image/jpeg,image/png,image/gif,image/heic,image/heif,image/webp",onChange:l}),e.jsx(Je,{color:"primary","aria-label":"add",size:"small",type:"submit",children:e.jsx(Ze,{})})]})]})})})})},Ae=()=>{const t=V(),[s]=ye();return{handleChatClick:r=>{var o;r.dialog&&!((o=r.dialog)!=null&&o.readed)&&s({fromId:r.dialog.fromId}),t(`/chat/${r.human.id}`)}}},Yt=({open:t,onClose:s,getPageFn:n,data:r,isFetching:o,Localize:a})=>{const i=h=>Q(h,s),[l,c]=p.useState(3),{handleChatClick:d}=Ae(),[u,x]=p.useState([]),g=h=>{const{scrollTop:C,clientHeight:L,scrollHeight:T}=h.currentTarget;!o&&C+L>T-200&&(n(l),c(l+1))};return p.useEffect(()=>{n(2)},[n]),p.useEffect(()=>x(h=>[...h,...r??[]]),[r,x]),e.jsx(D,{open:t,onClose:i,children:e.jsx(R,{in:t,children:e.jsxs(w,{sx:{bgcolor:"white",py:2,borderTopLeftRadius:10,borderTopRightRadius:10,position:"absolute",left:0,right:0,bottom:0,height:"80%",overflowY:"scroll"},onScroll:g,children:[e.jsx(y,{variant:"h4",textAlign:"center",children:e.jsx(a,{})}),e.jsx(X,{handleChatClick:d,data:u}),o&&e.jsx(b,{})]})})})},_=O({reducerPath:"search/api",baseQuery:P({baseUrl:"https://search.api.dc2.a4sex.net/api/",prepareHeaders:(t,{getState:s})=>{t.set("Authorization","Bearer "+H(s()))}}),endpoints:t=>({getUser:t.query({query:s=>`/users/${s}`})})}),{useGetUserQuery:Ie}=_,$t=({acquaint:t,open:s,onClose:n,...r})=>{var d;const o=V(),a=()=>o(`/chat/${t==null?void 0:t.human.id}`),i=u=>Q(u,n),{data:l,isFetching:c}=Ie((t==null?void 0:t.human.id)??et.skipToken);return e.jsx(D,{open:s,onClose:i,children:e.jsx(R,{in:s,children:e.jsxs(w,{sx:{bgcolor:"white",py:2,borderTopLeftRadius:10,borderTopRightRadius:10,position:"absolute",left:0,right:0,bottom:0,maxHeight:"80%",overflow:"auto"},children:[t&&e.jsxs(S,{sx:{mb:2},children:[e.jsxs(S,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1},children:[e.jsx(S,{sx:{flexGrow:0},children:e.jsx(J,{userId:t.human.id,placeHolder:t.human})}),e.jsx(v,{sx:{color:"#000"},onClick:a,tabIndex:-1,children:e.jsx(tt,{})})]}),e.jsx(es,{tags:l==null?void 0:l.tags,isLoading:c}),e.jsx(y,{color:"text.secondary",sx:{overflow:"hidden",textOverflow:"ellipsis",mt:1},children:(d=t.dialog)==null?void 0:d.message})]}),e.jsx(Se,{humanId:t==null?void 0:t.human.id,...r})]})})})},Wt=10*60,Xt=t=>t<=Wt,z={fontSize:"inherit"},Kt={small:12,default:15,large:20},Jt=({isOnline:t=!1,hideOffline:s=!1,sx:n})=>e.jsx(ue,{label:t?e.jsx(m,{id:"ONLINE"}):e.jsx(m,{id:"OFFLINE"}),color:t?"warning":"default",variant:"outlined",size:"small",sx:{...s&&!t&&{opacity:0},...n}}),Zt=({name:t,age:s,city:n,isOnline:r,size:o="default"})=>e.jsxs(S,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(Y,{direction:"row",alignItems:"center",flexWrap:"wrap",sx:{fontSize:Kt[o],columnGap:1},children:[e.jsx(y,{component:"span",sx:z,children:t??"Unknown"}),s&&e.jsx(y,{component:"span",color:"error.main",sx:z,children:s}),n&&e.jsx(y,{component:"span",color:"primary.main",sx:z,children:n})]}),e.jsx(Jt,{isOnline:r,sx:{ml:2},hideOffline:!0})]}),J=({userId:t,placeHolder:s,size:n})=>{const{data:r}=Ie(t);return e.jsx(Zt,{name:(r==null?void 0:r.name)??(s==null?void 0:s.name),age:(r==null?void 0:r.age)??(s==null?void 0:s.age),city:(r==null?void 0:r.city)??(s==null?void 0:s.city),isOnline:r&&Xt(r==null?void 0:r.last),size:n})},es=({tags:t,isLoading:s=!1})=>s?e.jsx(b,{size:"small"}):!t||!t.length?e.jsx(e.Fragment,{}):e.jsx(S,{sx:{display:"flex",flexWrap:"wrap",maxHeight:100,overflow:"auto"},children:t.map(n=>e.jsx(ue,{variant:"outlined",color:"secondary",size:"small",label:n.tag,sx:{mb:1,mr:1}},n.id))}),ts=()=>{const{data:t,isLoading:s}=Mt(void 0,{pollingInterval:G}),[n,{data:r,isFetching:o}]=Pt({refetchOnFocus:!1}),[a]=_t(),[i,l]=p.useState(),[c,d]=p.useState(!1),u=h=>{var C;(C=h.dialog)!=null&&C.readed||a(h.id),l(h),d(!0)},x=()=>d(!1),g=()=>d(!1);return e.jsxs(e.Fragment,{children:[e.jsx(y,{variant:"h4",textAlign:"center",children:e.jsx(m,{id:"ACQUAINTANCES"})}),e.jsx(X,{data:t,handleChatClick:u,isLoading:s}),e.jsx(Ce,{Localize:()=>e.jsx(m,{id:"ACQUAINTANCES_HISTORY"}),getDataFn:n,data:r,isFetching:o,drawButton:((t==null?void 0:t.length)??0)>=ge}),e.jsx($t,{onClose:x,open:c,acquaint:i,onDataSended:g})]})},ss=()=>{const{data:t,isLoading:s}=kt(void 0,{pollingInterval:G}),[n,{data:r,isFetching:o}]=Et({refetchOnFocus:!1}),{handleChatClick:a}=Ae();return e.jsxs(e.Fragment,{children:[e.jsx(y,{variant:"h4",textAlign:"center",children:e.jsx(m,{id:"CHATS"})}),e.jsx(X,{handleChatClick:a,data:t,isLoading:s}),e.jsx(Ce,{Localize:()=>e.jsx(m,{id:"CHATS_HISTORY"}),getDataFn:n,data:r,isFetching:o,drawButton:((t==null?void 0:t.length)??0)>=ge})]})},ns=()=>{const t=U(),s=Number(t.interlocutorId);return e.jsxs(e.Fragment,{children:[e.jsx(S,{sx:{position:"sticky",top:0,zIndex:1,backgroundColor:"#fff",py:2,display:"flex",justifyContent:"center"},children:e.jsx(J,{userId:s,size:"large"})}),e.jsx(Ut,{}),e.jsx(S,{sx:{top:"auto",bottom:0,left:0,backgroundColor:"#fff",position:"fixed",width:"100%"},children:e.jsx(w,{sx:{py:2},children:e.jsx(Se,{multiline:!0})})})]})},rs=()=>{const[t,{data:s,isLoading:n}]=qt(),[r,o]=p.useState(""),[a,i]=p.useState(""),[l,c]=p.useState(""),[d,u]=p.useState(!1),x=j=>{o(j.currentTarget.value),c("")},g=j=>{i(j.currentTarget.value),c("")},h=j=>t({login:Number(r),password:a,captcha:j}),C=j=>{j.preventDefault(),h()},L=j=>h(j),T=()=>u(!1);return p.useEffect(()=>{if(!(s!=null&&s.error))return;({auth:()=>c(s.say),code:()=>{c(s.say),u(!0)}})[s.error]()},[s]),e.jsxs(e.Fragment,{children:[e.jsxs(Y,{component:"form",sx:{margin:"0 auto",mt:8,width:"25ch"},spacing:2,noValidate:!0,autoComplete:"off",onSubmit:C,children:[e.jsx(se,{size:"small",label:e.jsx(m,{id:"LOGIN_TO_ACCOUNT"}),type:"number",value:r,onChange:x,error:!!l}),e.jsx(se,{size:"small",label:e.jsx(m,{id:"PASSWORD"}),type:"password",value:a,onChange:g,error:!!l,helperText:l}),e.jsx(v,{variant:"contained",type:"submit",disabled:n,children:e.jsx(m,{id:"LOGIN_BUTTON"})}),e.jsx(v,{variant:"outlined",disabled:!0,children:e.jsx(m,{id:"REGISTER_BUTTON"})})]}),e.jsx(Te,{open:d,onClose:T,onSubmit:L,refetch:(s==null?void 0:s.error)==="code"})]})},os=he([{path:M.CHATS,element:e.jsx(Ht,{logged:!0}),children:[{index:!0,element:e.jsx(ss,{})},{path:M.ACQUAINTANCES,element:e.jsx(ts,{})}]},{path:"/",element:e.jsx(K,{logged:!0}),children:[{path:M.CHAT,element:e.jsx(ns,{})}]}]),as=he([{path:"*",element:e.jsx(K,{}),children:[{path:"*",element:e.jsx(rs,{})}]}]),is=()=>{const s=je(W)!==null;return e.jsx(st,{router:s?os:as})},ve=nt({reducer:{auth:mt,settings:It,[I.reducerPath]:I.reducer,[E.reducerPath]:E.reducer,[F.reducerPath]:F.reducer,[A.reducerPath]:A.reducer,[N.reducerPath]:N.reducer,[_.reducerPath]:_.reducer},middleware:t=>t().concat(I.middleware,E.middleware,F.middleware,A.middleware,N.middleware,_.middleware)});rt.setupListeners(ve.dispatch);ot.createRoot(document.getElementById("root")).render(e.jsx(at,{store:ve,children:e.jsx(is,{})}));
