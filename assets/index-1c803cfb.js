import{c as ae,f as k,a as M,u as D,j as e,b as _e,T as y,G as te,B as S,r as g,L as ie,d as ce,e as le,H as De,g as Re,h as Ue,A as Ge,i as v,k as Qe,l as ze,m as de,n as V,o as He,P as B,p as qe,q as se,s as re,E as Ve,F as Be,C as Ye,t as $e,v as We,w as O,x as Xe,O as Ke,S as Y,y as ue,I as he,z as ge,D as Je,J as Ze,M as R,K as U,N as et,Q as tt,R as st,U as rt,V as pe,W as ne,X as me,Y as nt,Z as ot,_ as at,$ as it,a0 as ct,a1 as lt,a2 as dt,a3 as ut,a4 as ht,a5 as gt}from"./vendor-c9b53fb8.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(o){if(o.ep)return;o.ep=!0;const a=r(o);fetch(o.href,a)}})();const xe="https://photo.api.dc2.a4sex.net",pt="https://userpic.api.dc2.a4sex.net",mt="https://cors-zst8.onrender.com/",G=1e3,P={CHATS:"",ACQUAINTANCES:"acquaintances",CHAT:"chat/:interlocutorId"},fe=15,xt="en",Q=(t,s)=>t.target===t.currentTarget&&s(),$=t=>Object.entries(t).forEach(([s,r])=>localStorage.setItem(s,JSON.stringify(r))),ft=(...t)=>t.forEach(s=>localStorage.removeItem(s)),je=t=>{const s={};for(const r in t){const n=t[r],o=JSON.parse(localStorage.getItem(r)??"null",n==="default"?void 0:(a,i)=>n(i));s[r]=o}return s},jt=je({refreshToken:"default",accessToken:"default",login:"default"}),ye=ae({name:"auth",initialState:jt,reducers:{updateAccessToken:(t,s)=>{t.accessToken=s.payload},login:(t,s)=>{const{login:r,refresh:n,token:o}=s.payload;t.login=r,t.refreshToken=n,t.accessToken=o},logout:t=>{t.login=null,t.refreshToken=null,t.accessToken=null}}}),{updateAccessToken:yt,login:Ct,logout:St}=ye.actions,z=t=>t.auth.accessToken,W=t=>t.auth.refreshToken,Ce=t=>t.auth.login,At=ye.reducer,Tt=k({baseUrl:"https://auth.api.dc2.a4sex.net/api/v1/",method:"post"}),H=t=>async(s,r,n)=>{var i;const o=k({...t,prepareHeaders:(c,{getState:l})=>c.set("Authorization","Bearer "+z(l()))});let a=await o(s,r,n);if(((i=a==null?void 0:a.error)==null?void 0:i.status)===401){const c=await Tt({url:"/refresh",body:{token:W(r.getState())}},r,n);if(c.error)return{error:c.error};const l=c.data.token;r.dispatch(yt(l)),$({accessToken:l}),a=await o(s,r,n)}return a},E=M({reducerPath:"photo/api",baseQuery:H({baseUrl:"https://photo.api.dc2.a4sex.net/"}),tagTypes:["Photos"],endpoints:t=>({getPhoto:t.query({query:({alias:s,interlocutorId:r})=>({url:`/sends/${s}`,params:{tid:r}}),transformResponse:s=>({...s.photo,alias:s.photo.copy})}),getUsersPhotos:t.query({query:()=>({url:"/photos"}),transformResponse:s=>s.photos,providesTags:["Photos"]}),uploadPhoto:t.mutation({query:s=>({url:"/upload",method:"post",body:s}),invalidatesTags:["Photos"]})})}),{useLazyGetPhotoQuery:fs,useGetPhotoQuery:It,useGetUsersPhotosQuery:vt,useUploadPhotoMutation:bt}=E,wt=({alias:t})=>{const s=D(),r=Number(s.interlocutorId),{data:n,isLoading:o}=It({alias:t,interlocutorId:r});return!n||o?e.jsx(w,{}):e.jsx("img",{alt:t,src:xe+n._links.origin.href,loading:"lazy",style:{width:"100%"}})},Lt={locale:xt},Ot=ae({name:"settings",initialState:Lt,reducers:{}}),Mt=t=>t.settings.locale,Pt=Ot.reducer,Se=_e,kt={ACQUAINTANCES:{en:"Acquaintances",ru:"Знакомства"},CHATS:{en:"Chats",ru:"Диалоги"},EMPTY_MESSAGES:{en:"No messages",ru:"Нет сообщений"},LOGOUT:{en:"Logout",ru:"Выйти"},MESSAGE:{en:"Message",ru:"Сообщение"},VERIFY_CODE:{en:"Code",ru:"Код"},UPLOADED_PHOTOS:{en:"Uploaded photos",ru:"Загруженные изображения"},EMPTY_UPLOADED_PHOTOS:{en:"No uploaded photos",ru:"Нет загруженных изображений"},CHATS_HISTORY:{en:"Chats history",ru:"История диалогов"},ACQUAINTANCES_HISTORY:{en:"Acquaintances history",ru:"История знакомств"},LOGIN:{en:"Login",ru:"Логин"},PASSWORD:{en:"Password",ru:"Пароль"},LOGIN_TO_ACCOUNT:{en:"Login to account",ru:"Войти в аккаунт"},LOGIN_BUTTON:{en:"Login",ru:"Войти"},REGISTER_BUTTON:{en:"Register",ru:"Зарегистрироваться"},ONLINE:{en:"Online",ru:"Онлайн"},OFFLINE:{en:"Offline",ru:"Оффлайн"}},x=({id:t})=>{const s=Se(Mt),r=kt;return e.jsx(e.Fragment,{children:r[t][s]??r[t].en})},Et=({data:t,isLoading:s,onPhotoClick:r})=>s?e.jsx(w,{}):!t||!t.length?e.jsx(y,{variant:"h4",textAlign:"center",mb:2,children:e.jsx(x,{id:"EMPTY_UPLOADED_PHOTOS"})}):e.jsxs(e.Fragment,{children:[e.jsx(y,{variant:"h4",textAlign:"center",mb:2,children:e.jsx(x,{id:"UPLOADED_PHOTOS"})}),e.jsx(te,{container:!0,spacing:2,children:t.map(n=>e.jsx(te,{item:!0,xs:6,sm:4,md:3,children:e.jsx(S,{sx:{position:"relative",width:"100%",pb:"100%",cursor:"pointer"},onClick:()=>r&&r(n.alias),children:e.jsx("img",{src:xe+n._links.origin.href,alt:n.alias,loading:"lazy",style:{position:"absolute",width:"100%",height:"100%",objectFit:"cover"}})})},n.id))})]}),T=M({reducerPath:"mailer/api",baseQuery:k({baseUrl:mt+"https://freedom-sex.com/mailer/",prepareHeaders:(t,{getState:s})=>{t.set("Authorization","Bearer "+W(s())),t.set("X-Requested-With","XMLHttpRequest")}}),tagTypes:["Status"],endpoints:t=>({sendData:t.mutation({query:s=>({url:"/post",method:"post",body:s})}),getStatus:t.query({query:()=>"/status",providesTags:["Status"]}),checkMessages:t.mutation({query:()=>"/check_message",onQueryStarted:async(s,{dispatch:r,queryFulfilled:n})=>{const o=r(T.util.updateQueryData("getStatus",void 0,a=>{a.message=8}));try{await n}catch{o.undo()}},invalidatesTags:["Status"]}),checkContacts:t.mutation({query:()=>"/check_contact",onQueryStarted:async(s,{dispatch:r,queryFulfilled:n})=>{const o=r(T.util.updateQueryData("getStatus",void 0,a=>{a.contact=8}));try{await n}catch{o.undo()}},invalidatesTags:["Status"]})})}),{useGetStatusQuery:Nt}=T,Ft=H({baseUrl:"https://visit.api.dc2.a4sex.net/api/",prepareHeaders:(t,{getState:s})=>t.set("Authorization","Bearer "+z(s()))}),oe=H({baseUrl:"https://dialog.api.dc2.a4sex.net/api/"}),_t=(t,s,r)=>{if(r!=null&&r.postVisit&&s.dispatch(I.endpoints.postVisit.initiate()),r!=null&&r.addUserId){const n=Ce(s.getState());if(!n)return{error:{status:400,statusText:"Bad Request",data:"No user ID received"}};const o=typeof t=="string"?{url:t,params:{userId:n}}:{...t,params:{...t.params,userId:n}};return oe(o,s,r)}return oe(t,s,r)},I=M({reducerPath:"dialog/api",baseQuery:_t,refetchOnMountOrArgChange:!0,tagTypes:["Messages"],endpoints:t=>({getAcquaints:t.query({queryFn:(s,{dispatch:r},n,o)=>(r(T.endpoints.checkContacts.initiate()),o({url:"/contact_initials",params:{page:s}})),extraOptions:{addUserId:!0,postVisit:!0}}),getChats:t.query({queryFn:async(s,{dispatch:r,getState:n},o,a)=>{r(T.endpoints.checkMessages.initiate());const i=await a({url:"/contact_intimates",params:{page:s}});if(i!=null&&i.error)return{error:i.error};let c;const l=I.endpoints.getChats.select()(n()).data;l?c=l.reduce((h,p)=>({...h,[p.id]:p}),{}):c=je({readChats:"default"}).readChats;const u=i.data.map(h=>{var A;if(!h.dialog)return h;const p=c==null?void 0:c[h.id],m=new Date((p==null?void 0:p.updated)??0).getTime(),d=new Date(h.updated).getTime(),f=!!((A=p==null?void 0:p.dialog)!=null&&A.readed&&d-m<1e4);return{...h,dialog:{...h.dialog,readed:f}}});return $({readChats:c}),{data:u}},extraOptions:{addUserId:!0,postVisit:!0}}),getMessages:t.query({queryFn:(s,{getState:r},n,o)=>{const a=Ce(r())+"";return o({url:`/v1/users/${a}/dialog`,params:{tid:s}})},extraOptions:{postVisit:!0},providesTags:["Messages"]}),sendData:t.mutation({queryFn:(s,r)=>r.dispatch(T.endpoints.sendData.initiate(s)),invalidatesTags:["Messages"]}),postVisit:t.query({queryFn:(s,r,n)=>Ft({url:"/visit"},r,n)}),readAcquaint:t.mutation({query:s=>({url:`contact_initials/${s}`,method:"put",body:{unread:!1}}),onQueryStarted:async(s,{dispatch:r,queryFulfilled:n})=>{const o=r(I.util.updateQueryData("getAcquaints",void 0,a=>{const i=a.find(c=>c.id===s);i!=null&&i.dialog&&(i.dialog.readed=!0)}));try{await n}catch{o.undo()}}}),readChat:t.mutation({queryFn:({fromId:s,updated:r},{dispatch:n})=>(n(I.util.updateQueryData("getChats",void 0,o=>{const a=o.find(i=>{var c;return((c=i.dialog)==null?void 0:c.fromId)===s});a&&(a.dialog&&(a.dialog.readed=!0),r&&(a.updated=r))})),{data:null})})})}),{useGetAcquaintsQuery:Dt,useLazyGetAcquaintsQuery:Rt,useGetChatsQuery:Ut,useLazyGetChatsQuery:Gt,useGetMessagesQuery:Qt,useSendDataMutation:zt,useReadAcquaintMutation:Ht,useReadChatMutation:Ae}=I,qt=()=>{const t=D(),s=Number(t.interlocutorId),{data:r,isLoading:n}=Qt(s,{pollingInterval:G}),[o]=Ae();return g.useEffect(()=>()=>{var a;r&&o({fromId:s,updated:(a=r[0])==null?void 0:a.added})},[o,s,r]),n?e.jsx(w,{}):!r||!r.length?e.jsx(y,{variant:"h5",textAlign:"center",children:e.jsx(x,{id:"EMPTY_MESSAGES"})}):e.jsx(ie,{sx:{mb:"120px"},children:r.slice().reverse().map(a=>{var u;const i=new Date(a.added),c=[i.toLocaleTimeString("ru"),i.toLocaleDateString("ru")].join(" "),l=(u=a.message.match(/\[\[IMG:(\w+)/))==null?void 0:u.at(1);return e.jsx(ce,{disablePadding:!0,sx:{...a.fromId!==s&&{justifyContent:"end",textAlign:"right"}},children:e.jsx(le,{primary:l?e.jsx(wt,{alias:l}):De(a.message),secondary:c,sx:{p:"5px",maxWidth:"80%",borderRadius:"5px",border:"1px solid #dee2e6",wordWrap:"break-word",flexGrow:0}})},a.id)})})},X=({data:t,isLoading:s=!1,handleChatClick:r})=>s?e.jsx(w,{}):!t||!t.length?e.jsx(y,{variant:"h5",textAlign:"center",children:e.jsx(x,{id:"EMPTY_MESSAGES"})}):e.jsx(ie,{children:t.map(({dialog:n,human:o,id:a},i)=>{var c;return e.jsx(Vt,{user:o,userpicSrc:(c=o.userpic)==null?void 0:c.source,message:n==null?void 0:n.message,onClick:()=>{r&&r(t[i])},dimItem:n==null?void 0:n.readed},a)})}),Vt=({user:t,userpicSrc:s,message:r,onClick:n,dimItem:o=!1})=>{var i;const a=()=>n&&n();return e.jsx(ce,{alignItems:"flex-start",disableGutters:!0,disabled:o,children:e.jsxs(Re,{divider:!0,onClick:a,disableGutters:!0,children:[e.jsx(Ue,{children:e.jsx(Ge,{alt:t.name??void 0,src:s&&pt+s,sx:{bgcolor:`#${t.id}`.slice(0,-2)},children:(i=t.name)==null?void 0:i.at(0)})}),e.jsx(le,{disableTypography:!0,primary:e.jsx(J,{userId:t.id,placeHolder:t}),secondary:e.jsx(y,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",color:"text.secondary"},children:r})})]})})},Te=({Localize:t,getDataFn:s,data:r,isFetching:n,drawButton:o=!0})=>{const[a,i]=g.useState(!1),c=()=>i(!0),l=()=>i(!1);return e.jsxs(e.Fragment,{children:[o&&e.jsx(S,{textAlign:"center",children:e.jsx(v,{variant:"contained",onClick:c,children:e.jsx(t,{})})}),e.jsx(es,{open:a,onClose:l,getPageFn:s,isFetching:n,data:r,Localize:t})]})},Bt=Qe({components:{MuiBottomNavigationAction:{styleOverrides:{root:({ownerState:t})=>({[`&.${ze.selected}`]:{...t.value==="acquaints"&&{color:"#f33"}}})}}}}),Yt=()=>{const t=de(),s=V(),{data:r}=Nt(void 0,{pollingInterval:G}),[n,o]=g.useState(t.pathname.slice(1).split("/").at(0));return e.jsx(He,{theme:Bt,children:e.jsx(B,{sx:{position:"fixed",bottom:0,left:0,right:0},elevation:3,children:e.jsxs(qe,{showLabels:!0,value:n,onChange:(a,i)=>o(i),children:[e.jsx(se,{label:e.jsx(x,{id:"CHATS"}),icon:e.jsx(re,{invisible:!r||r.message===8,variant:"dot",color:"error",children:e.jsx(Ve,{})}),value:P.CHATS,onClick:()=>s("/")}),e.jsx(se,{label:e.jsx(x,{id:"ACQUAINTANCES"}),icon:e.jsx(re,{invisible:!r||r.contact===8,variant:"dot",color:"error",children:e.jsx(Be,{})}),value:P.ACQUAINTANCES,onClick:()=>s("/acquaintances")})]})})})},$t={small:25,default:50,large:75},w=({disableMargin:t=!1,size:s="default"})=>e.jsx(S,{sx:{textAlign:"center",...!t&&{mt:2}},children:e.jsx(Ye,{size:$t[s]})}),Wt=t=>e.jsxs(e.Fragment,{children:[e.jsx(K,{...t}),e.jsx(Yt,{})]}),N=M({reducerPath:"auth/api",baseQuery:H({baseUrl:"https://auth.api.dc2.a4sex.net/api/v1/",method:"post"}),endpoints:t=>({login:t.mutation({queryFn:async({captcha:s,...r},{dispatch:n},o,a)=>{const i=await a({url:"/login",body:{...s,...r}});if(i.error)return{error:i.error};const c=i.data;if(c.error)return i;const{token:l,refresh:u}=c;return n(Ct({token:l,refresh:u,login:r.login})),$({login:r.login,refreshToken:u,accessToken:l}),i}}),logout:t.mutation({queryFn:(s,{dispatch:r})=>(r(St()),ft("login","refreshToken","accessToken"),{data:null})})})}),{useLoginMutation:Xt,useLogoutMutation:Kt}=N,K=({logged:t,children:s=e.jsx(Ke,{})})=>{const[r]=Kt(),n=()=>window.confirm("Are you sure to logout?")&&r();return e.jsxs(e.Fragment,{children:[e.jsx($e,{}),e.jsx(We,{position:"static",sx:{mb:2},children:e.jsx(O,{children:e.jsxs(Xe,{disableGutters:!0,children:[e.jsx(y,{variant:"h6",noWrap:!0,component:"div",sx:{flexGrow:1},children:"Freedom Chat"}),t&&e.jsx(v,{color:"inherit",tabIndex:-1,onClick:n,children:e.jsx(x,{id:"LOGOUT"})})]})})}),e.jsx(O,{sx:{pb:"100px",position:"relative"},children:s})]})},Ie=({multiline:t,onDataSended:s,humanId:r,onMessageChange:n,initialMessage:o=""})=>{const[a,i]=g.useState(!1),[c,l]=g.useState(!1),[u,h]=g.useState(o),p=D(),m=Number(p.interlocutorId),[d,{data:f,isLoading:L}]=zt(),A=({type:j,...b})=>{d({...b,id:r??m})},[C,Z]=g.useState({});g.useEffect(()=>{if(f){if(f.error==="need_captcha")return i(!0);i(!1),l(!1),h(""),s&&s()}},[f,s]);const ee=()=>{if(!u.length)return;const j={type:"message",mess:u,id:m};Z(j),A(j)},Oe=j=>{j.preventDefault(),ee()},Me=j=>{const b={type:"photo",photo:j,id:m};Z(b),A(b)},Pe=()=>l(!0),ke=()=>l(!1),Ee=()=>i(!1),Ne=j=>{const b=j.currentTarget.value;h(b),n&&n(b)},Fe=j=>j.ctrlKey&&j.key==="Enter"&&ee();return e.jsxs(e.Fragment,{children:[e.jsxs(Y,{component:"form",direction:"row",width:"100%",onSubmit:Oe,children:[e.jsxs(ue,{size:"small",sx:{flexGrow:1},disabled:L,children:[e.jsx(he,{htmlFor:"messageInput",children:e.jsx(x,{id:"MESSAGE"})}),e.jsx(ge,{label:e.jsx(x,{id:"MESSAGE"}),id:"messageInput",autoComplete:"off",onChange:Ne,value:u,multiline:t,maxRows:3,onKeyDown:Fe})]}),u.length?e.jsx(v,{color:"primary",type:"submit",children:e.jsx(Je,{})}):e.jsx(v,{color:"primary",type:"button",onClick:Pe,children:e.jsx(Ze,{})})]}),e.jsx(Zt,{open:c,onClose:ke,onPhotoSubmit:Me}),e.jsx(ve,{open:a,onClose:Ee,onSubmit:j=>{A({...C,captcha:j})},refetch:(f==null?void 0:f.error)==="need_captcha"})]})},F=M({reducerPath:"verify/api",baseQuery:k({baseUrl:"https://verify.api.dc2.a4sex.net/api/",method:"get",prepareHeaders:(t,{getState:s})=>{t.set("Authorization","Bearer "+z(s()))}}),endpoints:t=>({getVerify:t.query({queryFn:async(s,r,n,o)=>{var l;const a=await o({url:"/time"});if(a!=null&&a.error)return{error:a.error};let i={data:{}};for(;!((l=i.data)!=null&&l.token);)if(i=await o({url:"/token",method:"post",body:{id:a.data.id}}),i!=null&&i.error)return{error:i.error};const c=await o({url:`/image/${i.data.token}`});return c!=null&&c.error?{error:c.error}:{data:{token:i.data.token,image:"data:image/jpeg;base64,"+c.data.image}}}})})}),{useLazyGetVerifyQuery:Jt}=F,ve=({open:t,onClose:s,onSubmit:r,refetch:n})=>{const[o,{data:a,isFetching:i}]=Jt(),[c,l]=g.useState(""),u=m=>Q(m,s),h=m=>{const d=m.currentTarget.value;isNaN(+d)||d.length>4||(d.length>3&&r({token:(a==null?void 0:a.token)??"",code:+d}),l(d))};g.useEffect(()=>{n&&o(),l("")},[n,o]);const p=g.useCallback(m=>{if(!m)return;const d=m.querySelector("input");d==null||d.focus()},[]);return e.jsx(R,{open:t,onClose:u,children:e.jsx(U,{in:t,children:e.jsxs(B,{component:"form",sx:{borderRadius:5,p:2,position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",outline:0},children:[i&&e.jsx(w,{disableMargin:!0}),!i&&e.jsx("img",{alt:"Verify code",src:a==null?void 0:a.image,style:{display:"block",margin:"0 auto"}}),e.jsxs(ue,{size:"small",sx:{mt:1},children:[e.jsx(he,{htmlFor:"component-outlined",children:e.jsx(x,{id:"VERIFY_CODE"})}),e.jsx(ge,{label:e.jsx(x,{id:"VERIFY_CODE"}),id:"component-outlined",autoComplete:"off",onChange:h,value:c,type:"number",ref:p})]})]})})})},Zt=({open:t,onClose:s,onPhotoSubmit:r})=>{const n=vt(),[o]=bt(),a=l=>{l.preventDefault(),l.currentTarget.fileUpload.click()},i=l=>Q(l,s),c=l=>{const u=l.currentTarget.files;if(!(u!=null&&u.length))return;const h=new FormData;h.append("file",u[0]),o(h)};return e.jsx(R,{open:t,onClose:i,closeAfterTransition:!0,children:e.jsx(U,{in:t,children:e.jsx(O,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",height:"80%",outline:0},onClick:i,children:e.jsxs(B,{sx:{p:2,overflowY:"auto",maxHeight:"100%"},children:[e.jsx(Et,{...n,onPhotoClick:r}),e.jsxs(S,{component:"form",onSubmit:a,sx:{position:"sticky",bottom:0,textAlign:"end"},children:[e.jsx("input",{hidden:!0,type:"file",name:"fileUpload",multiple:!1,accept:"image/jpeg,image/png,image/gif,image/heic,image/heif,image/webp",onChange:c}),e.jsx(et,{color:"primary","aria-label":"add",size:"small",type:"submit",children:e.jsx(tt,{})})]})]})})})})},be=()=>{const t=V(),[s]=Ae();return{handleChatClick:n=>{var o;n.dialog&&!((o=n.dialog)!=null&&o.readed)&&s({fromId:n.dialog.fromId}),t(`/chat/${n.human.id}`)}}},es=({open:t,onClose:s,getPageFn:r,data:n,isFetching:o,Localize:a})=>{const i=d=>Q(d,s),[c,l]=g.useState(3),{handleChatClick:u}=be(),[h,p]=g.useState([]),m=d=>{const{scrollTop:f,clientHeight:L,scrollHeight:A}=d.currentTarget;!o&&f+L>A-200&&(r(c),l(c+1))};return g.useEffect(()=>{r(2)},[r]),g.useEffect(()=>p(d=>[...d,...n??[]]),[n,p]),e.jsx(R,{open:t,onClose:i,children:e.jsx(U,{in:t,children:e.jsxs(O,{sx:{bgcolor:"white",py:2,borderTopLeftRadius:10,borderTopRightRadius:10,position:"absolute",left:0,right:0,bottom:0,height:"80%",overflowY:"scroll"},onScroll:m,children:[e.jsx(y,{variant:"h4",textAlign:"center",children:e.jsx(a,{})}),e.jsx(X,{handleChatClick:u,data:h}),o&&e.jsx(w,{})]})})})},_=M({reducerPath:"search/api",baseQuery:k({baseUrl:"https://search.api.dc2.a4sex.net/api/",prepareHeaders:(t,{getState:s})=>{t.set("Authorization","Bearer "+z(s()))}}),endpoints:t=>({getUser:t.query({query:s=>`/users/${s}`})})}),{useGetUserQuery:we}=_,ts=({acquaint:t,open:s,onClose:r,...n})=>{var m;const o=V(),[a,i]=g.useState(""),c=()=>o(`/chat/${t==null?void 0:t.human.id}`,{state:{message:a}}),l=d=>Q(d,r),u=d=>i(d),{data:h,isFetching:p}=we((t==null?void 0:t.human.id)??st.skipToken);return e.jsx(R,{open:s,onClose:l,children:e.jsx(U,{in:s,children:e.jsxs(O,{sx:{bgcolor:"white",py:2,borderTopLeftRadius:10,borderTopRightRadius:10,position:"absolute",left:0,right:0,bottom:0,maxHeight:"80%",overflow:"auto"},children:[t&&e.jsxs(S,{sx:{mb:2},children:[e.jsxs(S,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1},children:[e.jsx(S,{sx:{flexGrow:0},children:e.jsx(J,{userId:t.human.id,placeHolder:t.human})}),e.jsx(v,{sx:{color:"#000"},onClick:c,tabIndex:-1,children:e.jsx(rt,{})})]}),e.jsx(is,{tags:h==null?void 0:h.tags,isLoading:p}),e.jsx(y,{color:"text.secondary",sx:{overflow:"hidden",textOverflow:"ellipsis",mt:1},children:(m=t.dialog)==null?void 0:m.message})]}),e.jsx(Ie,{humanId:t==null?void 0:t.human.id,onMessageChange:u,...n})]})})})},ss=10*60,rs=t=>t<=ss,q={fontSize:"inherit"},ns={small:12,default:15,large:20},os=({isOnline:t=!1,hideOffline:s=!1,sx:r})=>e.jsx(pe,{label:t?e.jsx(x,{id:"ONLINE"}):e.jsx(x,{id:"OFFLINE"}),color:t?"warning":"default",variant:"outlined",size:"small",sx:{...s&&!t&&{opacity:0},...r}}),as=({name:t,age:s,city:r,isOnline:n,size:o="default"})=>e.jsxs(S,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(Y,{direction:"row",alignItems:"center",flexWrap:"wrap",sx:{fontSize:ns[o],columnGap:1},children:[e.jsx(y,{component:"span",sx:q,children:t}),s&&e.jsx(y,{component:"span",color:"error.main",sx:q,children:s}),r&&e.jsx(y,{component:"span",color:"primary.main",sx:q,children:r})]}),e.jsx(os,{isOnline:n,sx:{ml:2},hideOffline:!0})]}),J=({userId:t,placeHolder:s,size:r})=>{const{data:n}=we(t,{refetchOnMountOrArgChange:!0});return e.jsx(as,{name:(n==null?void 0:n.name)??(s==null?void 0:s.name),age:(n==null?void 0:n.age)??(s==null?void 0:s.age),city:(n==null?void 0:n.city)??(s==null?void 0:s.city),isOnline:n&&rs(n==null?void 0:n.last),size:r})},is=({tags:t,isLoading:s=!1})=>s?e.jsx(w,{size:"small"}):!t||!t.length?e.jsx(e.Fragment,{}):e.jsx(S,{sx:{display:"flex",flexWrap:"wrap",maxHeight:100,overflow:"auto"},children:t.map(r=>e.jsx(pe,{variant:"outlined",color:"secondary",size:"small",label:r.tag,sx:{mb:1,mr:1}},r.id))}),cs=()=>{const{data:t,isLoading:s}=Dt(void 0,{pollingInterval:G}),[r,{data:n,isFetching:o}]=Rt({refetchOnFocus:!1}),[a]=Ht(),[i,c]=g.useState(),[l,u]=g.useState(!1),h=d=>{var f;(f=d.dialog)!=null&&f.readed||a(d.id),c(d),u(!0)},p=()=>u(!1),m=()=>u(!1);return e.jsxs(e.Fragment,{children:[e.jsx(y,{variant:"h4",textAlign:"center",children:e.jsx(x,{id:"ACQUAINTANCES"})}),e.jsx(X,{data:t,handleChatClick:h,isLoading:s}),e.jsx(Te,{Localize:()=>e.jsx(x,{id:"ACQUAINTANCES_HISTORY"}),getDataFn:r,data:n,isFetching:o,drawButton:((t==null?void 0:t.length)??0)>=fe}),e.jsx(ts,{onClose:p,open:l,acquaint:i,onDataSended:m})]})},ls=()=>{const{data:t,isLoading:s}=Ut(void 0,{pollingInterval:G}),[r,{data:n,isFetching:o}]=Gt({refetchOnFocus:!1}),{handleChatClick:a}=be();return e.jsxs(e.Fragment,{children:[e.jsx(y,{variant:"h4",textAlign:"center",children:e.jsx(x,{id:"CHATS"})}),e.jsx(X,{handleChatClick:a,data:t,isLoading:s}),e.jsx(Te,{Localize:()=>e.jsx(x,{id:"CHATS_HISTORY"}),getDataFn:r,data:n,isFetching:o,drawButton:((t==null?void 0:t.length)??0)>=fe})]})},ds=()=>{var n;const t=D(),s=Number(t.interlocutorId),r=de();return e.jsxs(e.Fragment,{children:[e.jsx(S,{sx:{position:"sticky",top:0,zIndex:1,backgroundColor:"#fff",py:2,display:"flex",justifyContent:"center"},children:e.jsx(J,{userId:s,size:"large"})}),e.jsx(qt,{}),e.jsx(S,{sx:{top:"auto",bottom:0,left:0,backgroundColor:"#fff",position:"fixed",width:"100%"},children:e.jsx(O,{sx:{py:2},children:e.jsx(Ie,{multiline:!0,initialMessage:(n=r.state)==null?void 0:n.message})})})]})},us=()=>{const[t,{data:s,isLoading:r}]=Xt(),[n,o]=g.useState(""),[a,i]=g.useState(""),[c,l]=g.useState(""),[u,h]=g.useState(!1),p=C=>{o(C.currentTarget.value),l("")},m=C=>{i(C.currentTarget.value),l("")},d=C=>t({login:Number(n),password:a,captcha:C}),f=C=>{C.preventDefault(),d()},L=C=>d(C),A=()=>h(!1);return g.useEffect(()=>{if(!(s!=null&&s.error))return;({auth:()=>l(s.say),code:()=>{l(s.say),h(!0)}})[s.error]()},[s]),e.jsxs(e.Fragment,{children:[e.jsxs(Y,{component:"form",sx:{margin:"0 auto",mt:8,width:"25ch"},spacing:2,noValidate:!0,autoComplete:"off",onSubmit:f,children:[e.jsx(ne,{size:"small",label:e.jsx(x,{id:"LOGIN_TO_ACCOUNT"}),type:"number",value:n,onChange:p,error:!!c}),e.jsx(ne,{size:"small",label:e.jsx(x,{id:"PASSWORD"}),type:"password",value:a,onChange:m,error:!!c,helperText:c}),e.jsx(v,{variant:"contained",type:"submit",disabled:r,children:e.jsx(x,{id:"LOGIN_BUTTON"})}),e.jsx(v,{variant:"outlined",disabled:!0,children:e.jsx(x,{id:"REGISTER_BUTTON"})})]}),e.jsx(ve,{open:u,onClose:A,onSubmit:L,refetch:(s==null?void 0:s.error)==="code"})]})},hs=me([{path:P.CHATS,element:e.jsx(Wt,{logged:!0}),children:[{index:!0,element:e.jsx(ls,{})},{path:P.ACQUAINTANCES,element:e.jsx(cs,{})}]},{path:"/",element:e.jsx(K,{logged:!0}),children:[{path:P.CHAT,element:e.jsx(ds,{})}]}]),gs=me([{path:"*",element:e.jsx(K,{}),children:[{path:"*",element:e.jsx(us,{})}]}]),ps=()=>{const s=Se(W)!==null;return e.jsx(nt,{router:s?hs:gs})},ms=()=>t=>s=>(it(s)&&ct("Something went wrong..",{variant:"error"}),t(s)),Le=ot({reducer:{auth:At,settings:Pt,[I.reducerPath]:I.reducer,[E.reducerPath]:E.reducer,[F.reducerPath]:F.reducer,[T.reducerPath]:T.reducer,[N.reducerPath]:N.reducer,[_.reducerPath]:_.reducer},middleware:t=>t().concat(I.middleware,E.middleware,F.middleware,T.middleware,N.middleware,_.middleware,ms)});at.setupListeners(Le.dispatch);lt.createRoot(document.getElementById("root")).render(e.jsx(dt,{store:Le,children:e.jsx(ut,{anchorOrigin:{vertical:"top",horizontal:"right"},autoHideDuration:2e3,action:t=>e.jsx(v,{sx:{color:"inherit"},size:"small",onClick:()=>ht(t),children:e.jsx(gt,{fontSize:"small"})}),children:e.jsx(ps,{})})}));
