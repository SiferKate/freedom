import{c as ae,f as P,a as O,u as D,j as e,b as _e,T as y,G as te,B as S,r as g,L as ie,d as le,e as ce,h as De,g as Ue,i as Re,A as Ge,k as v,l as Qe,m as ze,n as de,o as V,p as He,P as B,q as qe,s as se,t as ne,E as Ve,F as Be,C as Ye,v as $e,w as We,x as k,y as Xe,O as Ke,S as Y,z as ue,I as he,D as ge,H as Je,J as Ze,M as U,K as R,N as et,Q as tt,R as st,U as nt,V as pe,W as re,X as me,Y as rt,Z as ot,_ as at,$ as it,a0 as lt,a1 as ct,a2 as dt,a3 as ut,a4 as ht,a5 as gt}from"./vendor-1f9030f8.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerpolicy&&(a.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?a.credentials="include":o.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(o){if(o.ep)return;o.ep=!0;const a=n(o);fetch(o.href,a)}})();const xe="https://photo.api.dc2.a4sex.net",pt="https://userpic.api.dc2.a4sex.net",mt="https://cors-zst8.onrender.com/",G=6e4,M={CHATS:"",ACQUAINTANCES:"acquaintances",CHAT:"chat/:interlocutorId"},fe=15,xt="en",Q=(t,s)=>t.target===t.currentTarget&&s(),$=t=>Object.entries(t).forEach(([s,n])=>localStorage.setItem(s,JSON.stringify(n))),ft=(...t)=>t.forEach(s=>localStorage.removeItem(s)),je=t=>{const s={};for(const n in t){const r=t[n],o=JSON.parse(localStorage.getItem(n)??"null",r==="default"?void 0:(a,i)=>r(i));s[n]=o}return s},jt=je({refreshToken:"default",accessToken:"default",login:"default"}),ye=ae({name:"auth",initialState:jt,reducers:{updateAccessToken:(t,s)=>{t.accessToken=s.payload},login:(t,s)=>{const{login:n,refresh:r,token:o}=s.payload;t.login=n,t.refreshToken=r,t.accessToken=o},logout:t=>{t.login=null,t.refreshToken=null,t.accessToken=null}}}),{updateAccessToken:yt,login:Ct,logout:St}=ye.actions,z=t=>t.auth.accessToken,W=t=>t.auth.refreshToken,Ce=t=>t.auth.login,At=ye.reducer,Tt=P({baseUrl:"https://auth.api.dc2.a4sex.net/api/v1/",method:"post"}),H=t=>async(s,n,r)=>{const o=P({...t,prepareHeaders:(i,{getState:l})=>(i.set("Authorization","Bearer "+z(l())),i)});let a=await o(s,n,r);if(a!=null&&a.error){const i=await Tt({url:"/refresh",body:{token:W(n.getState())}},n,r);if(i.error)return{error:i.error};const l=i.data.token;n.dispatch(yt(l)),$({accessToken:l}),a=await o(s,n,r)}return a},E=O({reducerPath:"photo/api",baseQuery:H({baseUrl:"https://photo.api.dc2.a4sex.net/"}),tagTypes:["Photos"],endpoints:t=>({getPhoto:t.query({query:({alias:s,interlocutorId:n})=>({url:`/sends/${s}`,params:{tid:n}}),transformResponse:s=>({...s.photo,alias:s.photo.copy})}),getUsersPhotos:t.query({query:()=>({url:"/photos"}),transformResponse:s=>s.photos,providesTags:["Photos"]}),uploadPhoto:t.mutation({query:s=>({url:"/upload",method:"post",body:s}),invalidatesTags:["Photos"]})})}),{useLazyGetPhotoQuery:fs,useGetPhotoQuery:It,useGetUsersPhotosQuery:vt,useUploadPhotoMutation:bt}=E,wt=({alias:t})=>{const s=D(),n=Number(s.interlocutorId),{data:r,isLoading:o}=It({alias:t,interlocutorId:n});return!r||o?e.jsx(w,{}):e.jsx("img",{alt:t,src:xe+r._links.origin.href,loading:"lazy",style:{width:"100%"}})},Lt={locale:xt},kt=ae({name:"settings",initialState:Lt,reducers:{}}),Ot=t=>t.settings.locale,Mt=kt.reducer,Se=_e,Pt={ACQUAINTANCES:{en:"Acquaintances",ru:"Знакомства"},CHATS:{en:"Chats",ru:"Диалоги"},EMPTY_MESSAGES:{en:"No messages",ru:"Нет сообщений"},LOGOUT:{en:"Logout",ru:"Выйти"},MESSAGE:{en:"Message",ru:"Сообщение"},VERIFY_CODE:{en:"Code",ru:"Код"},UPLOADED_PHOTOS:{en:"Uploaded photos",ru:"Загруженные изображения"},EMPTY_UPLOADED_PHOTOS:{en:"No uploaded photos",ru:"Нет загруженных изображений"},CHATS_HISTORY:{en:"Chats history",ru:"История диалогов"},ACQUAINTANCES_HISTORY:{en:"Acquaintances history",ru:"История знакомств"},LOGIN:{en:"Login",ru:"Логин"},PASSWORD:{en:"Password",ru:"Пароль"},LOGIN_TO_ACCOUNT:{en:"Login to account",ru:"Войти в аккаунт"},LOGIN_BUTTON:{en:"Login",ru:"Войти"},REGISTER_BUTTON:{en:"Register",ru:"Зарегистрироваться"},ONLINE:{en:"Online",ru:"Онлайн"},OFFLINE:{en:"Offline",ru:"Оффлайн"}},x=({id:t})=>{const s=Se(Ot),n=Pt;return e.jsx(e.Fragment,{children:n[t][s]??n[t].en})},Et=({data:t,isLoading:s,onPhotoClick:n})=>s?e.jsx(w,{}):!t||!t.length?e.jsx(y,{variant:"h4",textAlign:"center",mb:2,children:e.jsx(x,{id:"EMPTY_UPLOADED_PHOTOS"})}):e.jsxs(e.Fragment,{children:[e.jsx(y,{variant:"h4",textAlign:"center",mb:2,children:e.jsx(x,{id:"UPLOADED_PHOTOS"})}),e.jsx(te,{container:!0,spacing:2,children:t.map(r=>e.jsx(te,{item:!0,xs:6,sm:4,md:3,children:e.jsx(S,{sx:{position:"relative",width:"100%",pb:"100%",cursor:"pointer"},onClick:()=>n&&n(r.alias),children:e.jsx("img",{src:xe+r._links.origin.href,alt:r.alias,loading:"lazy",style:{position:"absolute",width:"100%",height:"100%",objectFit:"cover"}})})},r.id))})]}),T=O({reducerPath:"mailer/api",baseQuery:P({baseUrl:mt+"https://freedom-sex.com/mailer/",prepareHeaders:(t,{getState:s})=>{t.set("Authorization","Bearer "+W(s())),t.set("X-Requested-With","XMLHttpRequest")}}),tagTypes:["Status"],endpoints:t=>({sendData:t.mutation({query:s=>({url:"/post",method:"post",body:s})}),getStatus:t.query({query:()=>"/status",providesTags:["Status"]}),checkMessages:t.mutation({query:()=>"/check_message",onQueryStarted:async(s,{dispatch:n,queryFulfilled:r})=>{const o=n(T.util.updateQueryData("getStatus",void 0,a=>{a.message=8}));try{await r}catch{o.undo()}},invalidatesTags:["Status"]}),checkContacts:t.mutation({query:()=>"/check_contact",onQueryStarted:async(s,{dispatch:n,queryFulfilled:r})=>{const o=n(T.util.updateQueryData("getStatus",void 0,a=>{a.contact=8}));try{await r}catch{o.undo()}},invalidatesTags:["Status"]})})}),{useGetStatusQuery:Nt}=T,Ft=H({baseUrl:"https://visit.api.dc2.a4sex.net/api/",prepareHeaders:(t,{getState:s})=>t.set("Authorization","Bearer "+z(s()))}),oe=H({baseUrl:"https://dialog.api.dc2.a4sex.net/api/"}),_t=(t,s,n)=>{if(n!=null&&n.postVisit&&s.dispatch(I.endpoints.postVisit.initiate()),n!=null&&n.addUserId){const r=Ce(s.getState());if(!r)return{error:{status:400,statusText:"Bad Request",data:"No user ID received"}};const o=typeof t=="string"?{url:t,params:{userId:r}}:{...t,params:{...t.params,userId:r}};return oe(o,s,n)}return oe(t,s,n)},I=O({reducerPath:"dialog/api",baseQuery:_t,refetchOnMountOrArgChange:!0,tagTypes:["Messages"],endpoints:t=>({getAcquaints:t.query({queryFn:(s,{dispatch:n},r,o)=>(n(T.endpoints.checkContacts.initiate()),o({url:"/contact_initials",params:{page:s}})),extraOptions:{addUserId:!0,postVisit:!0}}),getChats:t.query({queryFn:async(s,{dispatch:n,getState:r},o,a)=>{n(T.endpoints.checkMessages.initiate());const i=await a({url:"/contact_intimates",params:{page:s}});if(i!=null&&i.error)return{error:i.error};let l;const c=I.endpoints.getChats.select()(r()).data;c?l=c.reduce((h,p)=>({...h,[p.id]:p}),{}):l=je({readChats:"default"}).readChats;const u=i.data.map(h=>{var A;if(!h.dialog)return h;const p=l==null?void 0:l[h.id],m=new Date((p==null?void 0:p.updated)??0).getTime(),d=new Date(h.updated).getTime(),f=Boolean(((A=p==null?void 0:p.dialog)==null?void 0:A.readed)&&d-m<1e4);return{...h,dialog:{...h.dialog,readed:f}}});return $({readChats:l}),{data:u}},extraOptions:{addUserId:!0,postVisit:!0}}),getMessages:t.query({queryFn:(s,{getState:n},r,o)=>{const a=Ce(n())+"";return o({url:`/v1/users/${a}/dialog`,params:{tid:s,offset:0}})},extraOptions:{postVisit:!0},providesTags:["Messages"]}),sendData:t.mutation({queryFn:(s,n)=>n.dispatch(T.endpoints.sendData.initiate(s)),invalidatesTags:["Messages"]}),postVisit:t.query({queryFn:(s,n,r)=>Ft({url:"/visit"},n,r)}),readAcquaint:t.mutation({query:s=>({url:`contact_initials/${s}`,method:"put",body:{unread:!1}}),onQueryStarted:async(s,{dispatch:n,queryFulfilled:r})=>{const o=n(I.util.updateQueryData("getAcquaints",void 0,a=>{const i=a.find(l=>l.id===s);i!=null&&i.dialog&&(i.dialog.readed=!0)}));try{await r}catch{o.undo()}}}),readChat:t.mutation({queryFn:({fromId:s,updated:n},{dispatch:r})=>(r(I.util.updateQueryData("getChats",void 0,o=>{const a=o.find(i=>{var l;return((l=i.dialog)==null?void 0:l.fromId)===s});a&&(a.dialog&&(a.dialog.readed=!0),n&&(a.updated=n))})),{data:null})})})}),{useGetAcquaintsQuery:Dt,useLazyGetAcquaintsQuery:Ut,useGetChatsQuery:Rt,useLazyGetChatsQuery:Gt,useGetMessagesQuery:Qt,useSendDataMutation:zt,useReadAcquaintMutation:Ht,useReadChatMutation:Ae}=I,qt=()=>{const t=D(),s=Number(t.interlocutorId),{data:n,isLoading:r}=Qt(s,{pollingInterval:G}),[o]=Ae();return g.useEffect(()=>()=>{var a;n&&o({fromId:s,updated:(a=n[0])==null?void 0:a.added})},[o,s,n]),r?e.jsx(w,{}):!n||!n.length?e.jsx(y,{variant:"h5",textAlign:"center",children:e.jsx(x,{id:"EMPTY_MESSAGES"})}):e.jsx(ie,{sx:{mb:"120px"},children:n.slice().reverse().map(a=>{var u;const i=new Date(a.added),l=[i.toLocaleTimeString("ru"),i.toLocaleDateString("ru")].join(" "),c=(u=a.message.match(/\[\[IMG:(\w+)/))==null?void 0:u.at(1);return e.jsx(le,{disablePadding:!0,sx:{...a.fromId!==s&&{justifyContent:"end",textAlign:"right"}},children:e.jsx(ce,{primary:c?e.jsx(wt,{alias:c}):De(a.message),secondary:l,sx:{p:"5px",maxWidth:"80%",borderRadius:"5px",border:"1px solid #dee2e6",wordWrap:"break-word",flexGrow:0}})},a.id)})})},X=({data:t,isLoading:s=!1,handleChatClick:n})=>s?e.jsx(w,{}):!t||!t.length?e.jsx(y,{variant:"h5",textAlign:"center",children:e.jsx(x,{id:"EMPTY_MESSAGES"})}):e.jsx(ie,{children:t.map(({dialog:r,human:o,id:a},i)=>{var l;return e.jsx(Vt,{user:o,userpicSrc:(l=o.userpic)==null?void 0:l.source,message:r==null?void 0:r.message,onClick:()=>{n&&n(t[i])},dimItem:r==null?void 0:r.readed},a)})}),Vt=({user:t,userpicSrc:s,message:n,onClick:r,dimItem:o=!1})=>{var i;const a=()=>r&&r();return e.jsx(le,{alignItems:"flex-start",disableGutters:!0,disabled:o,children:e.jsxs(Ue,{divider:!0,onClick:a,disableGutters:!0,children:[e.jsx(Re,{children:e.jsx(Ge,{alt:t.name??void 0,src:s&&pt+s,sx:{bgcolor:`#${t.id}`.slice(0,-2)},children:(i=t.name)==null?void 0:i.at(0)})}),e.jsx(ce,{disableTypography:!0,primary:e.jsx(J,{userId:t.id,placeHolder:t}),secondary:e.jsx(y,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",color:"text.secondary"},children:n})})]})})},Te=({Localize:t,getDataFn:s,data:n,isFetching:r,drawButton:o=!0})=>{const[a,i]=g.useState(!1),l=()=>i(!0),c=()=>i(!1);return e.jsxs(e.Fragment,{children:[o&&e.jsx(S,{textAlign:"center",children:e.jsx(v,{variant:"contained",onClick:l,children:e.jsx(t,{})})}),e.jsx(es,{open:a,onClose:c,getPageFn:s,isFetching:r,data:n,Localize:t})]})},Bt=Qe({components:{MuiBottomNavigationAction:{styleOverrides:{root:({ownerState:t})=>({[`&.${ze.selected}`]:{...t.value==="acquaints"&&{color:"#f33"}}})}}}}),Yt=()=>{const t=de(),s=V(),{data:n}=Nt(void 0,{pollingInterval:G}),[r,o]=g.useState(t.pathname.slice(1).split("/").at(0));return e.jsx(He,{theme:Bt,children:e.jsx(B,{sx:{position:"fixed",bottom:0,left:0,right:0},elevation:3,children:e.jsxs(qe,{showLabels:!0,value:r,onChange:(a,i)=>o(i),children:[e.jsx(se,{label:e.jsx(x,{id:"CHATS"}),icon:e.jsx(ne,{invisible:!n||n.message===8,variant:"dot",color:"error",children:e.jsx(Ve,{})}),value:M.CHATS,onClick:()=>s("/")}),e.jsx(se,{label:e.jsx(x,{id:"ACQUAINTANCES"}),icon:e.jsx(ne,{invisible:!n||n.contact===8,variant:"dot",color:"error",children:e.jsx(Be,{})}),value:M.ACQUAINTANCES,onClick:()=>s("/acquaintances")})]})})})},$t={small:25,default:50,large:75},w=({disableMargin:t=!1,size:s="default"})=>e.jsx(S,{sx:{textAlign:"center",...!t&&{mt:2}},children:e.jsx(Ye,{size:$t[s]})}),Wt=t=>e.jsxs(e.Fragment,{children:[e.jsx(K,{...t}),e.jsx(Yt,{})]}),N=O({reducerPath:"auth/api",baseQuery:H({baseUrl:"https://auth.api.dc2.a4sex.net/api/v1/",method:"post"}),endpoints:t=>({login:t.mutation({queryFn:async({captcha:s,...n},{dispatch:r},o,a)=>{const i=await a({url:"/login",body:{...s,...n}});if(i.error)return{error:i.error};const l=i.data;if(l.error)return i;const{token:c,refresh:u}=l;return r(Ct({token:c,refresh:u,login:n.login})),$({login:n.login,refreshToken:u,accessToken:c}),i}}),logout:t.mutation({queryFn:(s,{dispatch:n})=>(n(St()),ft("login","refreshToken","accessToken"),{data:null})})})}),{useLoginMutation:Xt,useLogoutMutation:Kt}=N,K=({logged:t,children:s=e.jsx(Ke,{})})=>{const[n]=Kt(),r=()=>window.confirm("Are you sure to logout?")&&n();return e.jsxs(e.Fragment,{children:[e.jsx($e,{}),e.jsx(We,{position:"static",sx:{mb:2},children:e.jsx(k,{children:e.jsxs(Xe,{disableGutters:!0,children:[e.jsx(y,{variant:"h6",noWrap:!0,component:"div",sx:{flexGrow:1},children:"Freedom Chat"}),t&&e.jsx(v,{color:"inherit",tabIndex:-1,onClick:r,children:e.jsx(x,{id:"LOGOUT"})})]})})}),e.jsx(k,{sx:{pb:"100px",position:"relative"},children:s})]})},Ie=({multiline:t,onDataSended:s,humanId:n,onMessageChange:r,initialMessage:o=""})=>{const[a,i]=g.useState(!1),[l,c]=g.useState(!1),[u,h]=g.useState(o),p=D(),m=Number(p.interlocutorId),[d,{data:f,isLoading:L}]=zt(),A=({type:j,...b})=>{d({...b,id:n??m})},[C,Z]=g.useState({});g.useEffect(()=>{if(f){if(f.error==="need_captcha")return i(!0);i(!1),c(!1),h(""),s&&s()}},[f,s]);const ee=()=>{if(!u.length)return;const j={type:"message",mess:u,id:m};Z(j),A(j)},ke=j=>{j.preventDefault(),ee()},Oe=j=>{const b={type:"photo",photo:j,id:m};Z(b),A(b)},Me=()=>c(!0),Pe=()=>c(!1),Ee=()=>i(!1),Ne=j=>{const b=j.currentTarget.value;h(b),r&&r(b)},Fe=j=>j.ctrlKey&&j.key==="Enter"&&ee();return e.jsxs(e.Fragment,{children:[e.jsxs(Y,{component:"form",direction:"row",width:"100%",onSubmit:ke,children:[e.jsxs(ue,{size:"small",sx:{flexGrow:1},disabled:L,children:[e.jsx(he,{htmlFor:"messageInput",children:e.jsx(x,{id:"MESSAGE"})}),e.jsx(ge,{label:e.jsx(x,{id:"MESSAGE"}),id:"messageInput",autoComplete:"off",onChange:Ne,value:u,multiline:t,maxRows:3,onKeyDown:Fe})]}),u.length?e.jsx(v,{color:"primary",type:"submit",children:e.jsx(Je,{})}):e.jsx(v,{color:"primary",type:"button",onClick:Me,children:e.jsx(Ze,{})})]}),e.jsx(Zt,{open:l,onClose:Pe,onPhotoSubmit:Oe}),e.jsx(ve,{open:a,onClose:Ee,onSubmit:j=>{A({...C,captcha:j})},refetch:(f==null?void 0:f.error)==="need_captcha"})]})},F=O({reducerPath:"verify/api",baseQuery:P({baseUrl:"https://verify.api.dc2.a4sex.net/api/",method:"get",prepareHeaders:(t,{getState:s})=>{t.set("Authorization","Bearer "+z(s()))}}),endpoints:t=>({getVerify:t.query({queryFn:async(s,n,r,o)=>{var c;const a=await o({url:"/time"});if(a!=null&&a.error)return{error:a.error};let i={data:{}};for(;!((c=i.data)!=null&&c.token);)if(i=await o({url:"/token",method:"post",body:{id:a.data.id}}),i!=null&&i.error)return{error:i.error};const l=await o({url:`/image/${i.data.token}`});return l!=null&&l.error?{error:l.error}:{data:{token:i.data.token,image:"data:image/jpeg;base64,"+l.data.image}}}})})}),{useLazyGetVerifyQuery:Jt}=F,ve=({open:t,onClose:s,onSubmit:n,refetch:r})=>{const[o,{data:a,isFetching:i}]=Jt(),[l,c]=g.useState(""),u=m=>Q(m,s),h=m=>{const d=m.currentTarget.value;isNaN(+d)||d.length>4||(d.length>3&&n({token:(a==null?void 0:a.token)??"",code:+d}),c(d))};g.useEffect(()=>{r&&o(),c("")},[r,o]);const p=g.useCallback(m=>{if(!m)return;const d=m.querySelector("input");d==null||d.focus()},[]);return e.jsx(U,{open:t,onClose:u,children:e.jsx(R,{in:t,children:e.jsxs(B,{component:"form",sx:{borderRadius:5,p:2,position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",outline:0},children:[i&&e.jsx(w,{disableMargin:!0}),!i&&e.jsx("img",{alt:"Verify code",src:a==null?void 0:a.image,style:{display:"block",margin:"0 auto"}}),e.jsxs(ue,{size:"small",sx:{mt:1},children:[e.jsx(he,{htmlFor:"component-outlined",children:e.jsx(x,{id:"VERIFY_CODE"})}),e.jsx(ge,{label:e.jsx(x,{id:"VERIFY_CODE"}),id:"component-outlined",autoComplete:"off",onChange:h,value:l,type:"number",ref:p})]})]})})})},Zt=({open:t,onClose:s,onPhotoSubmit:n})=>{const r=vt(),[o]=bt(),a=c=>{c.preventDefault(),c.currentTarget.fileUpload.click()},i=c=>Q(c,s),l=c=>{const u=c.currentTarget.files;if(!(u!=null&&u.length))return;const h=new FormData;h.append("file",u[0]),o(h)};return e.jsx(U,{open:t,onClose:i,closeAfterTransition:!0,children:e.jsx(R,{in:t,children:e.jsx(k,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",height:"80%",outline:0},onClick:i,children:e.jsxs(B,{sx:{p:2,overflowY:"auto",maxHeight:"100%"},children:[e.jsx(Et,{...r,onPhotoClick:n}),e.jsxs(S,{component:"form",onSubmit:a,sx:{position:"sticky",bottom:0,textAlign:"end"},children:[e.jsx("input",{hidden:!0,type:"file",name:"fileUpload",multiple:!1,accept:"image/jpeg,image/png,image/gif,image/heic,image/heif,image/webp",onChange:l}),e.jsx(et,{color:"primary","aria-label":"add",size:"small",type:"submit",children:e.jsx(tt,{})})]})]})})})})},be=()=>{const t=V(),[s]=Ae();return{handleChatClick:r=>{var o;r.dialog&&!((o=r.dialog)!=null&&o.readed)&&s({fromId:r.dialog.fromId}),t(`/chat/${r.human.id}`)}}},es=({open:t,onClose:s,getPageFn:n,data:r,isFetching:o,Localize:a})=>{const i=d=>Q(d,s),[l,c]=g.useState(3),{handleChatClick:u}=be(),[h,p]=g.useState([]),m=d=>{const{scrollTop:f,clientHeight:L,scrollHeight:A}=d.currentTarget;!o&&f+L>A-200&&(n(l),c(l+1))};return g.useEffect(()=>{n(2)},[n]),g.useEffect(()=>p(d=>[...d,...r??[]]),[r,p]),e.jsx(U,{open:t,onClose:i,children:e.jsx(R,{in:t,children:e.jsxs(k,{sx:{bgcolor:"white",py:2,borderTopLeftRadius:10,borderTopRightRadius:10,position:"absolute",left:0,right:0,bottom:0,height:"80%",overflowY:"scroll"},onScroll:m,children:[e.jsx(y,{variant:"h4",textAlign:"center",children:e.jsx(a,{})}),e.jsx(X,{handleChatClick:u,data:h}),o&&e.jsx(w,{})]})})})},_=O({reducerPath:"search/api",baseQuery:P({baseUrl:"https://search.api.dc2.a4sex.net/api/",prepareHeaders:(t,{getState:s})=>{t.set("Authorization","Bearer "+z(s()))}}),endpoints:t=>({getUser:t.query({query:s=>`/users/${s}`})})}),{useGetUserQuery:we}=_,ts=({acquaint:t,open:s,onClose:n,...r})=>{var m;const o=V(),[a,i]=g.useState(""),l=()=>o(`/chat/${t==null?void 0:t.human.id}`,{state:{message:a}}),c=d=>Q(d,n),u=d=>i(d),{data:h,isFetching:p}=we((t==null?void 0:t.human.id)??st.skipToken);return e.jsx(U,{open:s,onClose:c,children:e.jsx(R,{in:s,children:e.jsxs(k,{sx:{bgcolor:"white",py:2,borderTopLeftRadius:10,borderTopRightRadius:10,position:"absolute",left:0,right:0,bottom:0,maxHeight:"80%",overflow:"auto"},children:[t&&e.jsxs(S,{sx:{mb:2},children:[e.jsxs(S,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1},children:[e.jsx(S,{sx:{flexGrow:0},children:e.jsx(J,{userId:t.human.id,placeHolder:t.human})}),e.jsx(v,{sx:{color:"#000"},onClick:l,tabIndex:-1,children:e.jsx(nt,{})})]}),e.jsx(is,{tags:h==null?void 0:h.tags,isLoading:p}),e.jsx(y,{color:"text.secondary",sx:{overflow:"hidden",textOverflow:"ellipsis",mt:1},children:(m=t.dialog)==null?void 0:m.message})]}),e.jsx(Ie,{humanId:t==null?void 0:t.human.id,onMessageChange:u,...r})]})})})},ss=10*60,ns=t=>t<=ss,q={fontSize:"inherit"},rs={small:12,default:15,large:20},os=({isOnline:t=!1,hideOffline:s=!1,sx:n})=>e.jsx(pe,{label:t?e.jsx(x,{id:"ONLINE"}):e.jsx(x,{id:"OFFLINE"}),color:t?"warning":"default",variant:"outlined",size:"small",sx:{...s&&!t&&{opacity:0},...n}}),as=({name:t,age:s,city:n,isOnline:r,size:o="default",onClick:a})=>e.jsxs(S,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(Y,{direction:"row",alignItems:"center",flexWrap:"wrap",sx:{fontSize:rs[o],columnGap:1,cursor:"pointer"},onClick:a,children:[e.jsx(y,{component:"span",sx:q,children:t}),s&&e.jsx(y,{component:"span",color:"error.main",sx:q,children:s}),n&&e.jsx(y,{component:"span",color:"primary.main",sx:q,children:n})]}),e.jsx(os,{isOnline:r,sx:{ml:2},hideOffline:!0})]}),J=({userId:t,placeHolder:s,...n})=>{const{data:r}=we(t,{refetchOnMountOrArgChange:!0});return e.jsx(as,{name:(r==null?void 0:r.name)??(s==null?void 0:s.name),age:(r==null?void 0:r.age)??(s==null?void 0:s.age),city:(r==null?void 0:r.city)??(s==null?void 0:s.city),isOnline:r&&ns(r==null?void 0:r.last),...n})},is=({tags:t,isLoading:s=!1})=>s?e.jsx(w,{size:"small"}):!t||!t.length?e.jsx(e.Fragment,{}):e.jsx(S,{sx:{display:"flex",flexWrap:"wrap",maxHeight:100,overflow:"auto"},children:t.map(n=>e.jsx(pe,{variant:"outlined",color:"secondary",size:"small",label:n.tag,sx:{mb:1,mr:1}},n.id))}),ls=()=>{const{data:t,isLoading:s}=Dt(void 0,{pollingInterval:G}),[n,{data:r,isFetching:o}]=Ut({refetchOnFocus:!1}),[a]=Ht(),[i,l]=g.useState(),[c,u]=g.useState(!1),h=d=>{var f;(f=d.dialog)!=null&&f.readed||a(d.id),l(d),u(!0)},p=()=>u(!1),m=()=>u(!1);return e.jsxs(e.Fragment,{children:[e.jsx(y,{variant:"h4",textAlign:"center",children:e.jsx(x,{id:"ACQUAINTANCES"})}),e.jsx(X,{data:t,handleChatClick:h,isLoading:s}),e.jsx(Te,{Localize:()=>e.jsx(x,{id:"ACQUAINTANCES_HISTORY"}),getDataFn:n,data:r,isFetching:o,drawButton:((t==null?void 0:t.length)??0)>=fe}),e.jsx(ts,{onClose:p,open:c,acquaint:i,onDataSended:m})]})},cs=()=>{const{data:t,isLoading:s}=Rt(void 0,{pollingInterval:G}),[n,{data:r,isFetching:o}]=Gt({refetchOnFocus:!1}),{handleChatClick:a}=be();return e.jsxs(e.Fragment,{children:[e.jsx(y,{variant:"h4",textAlign:"center",children:e.jsx(x,{id:"CHATS"})}),e.jsx(X,{handleChatClick:a,data:t,isLoading:s}),e.jsx(Te,{Localize:()=>e.jsx(x,{id:"CHATS_HISTORY"}),getDataFn:n,data:r,isFetching:o,drawButton:((t==null?void 0:t.length)??0)>=fe})]})},ds=()=>{var o;const t=D(),s=Number(t.interlocutorId),n=de(),r=()=>window.open(`https://siferkate.github.io/freedom-view/#/${s}`);return e.jsxs(e.Fragment,{children:[e.jsx(S,{sx:{position:"sticky",top:0,zIndex:1,backgroundColor:"#fff",py:2,display:"flex",justifyContent:"center"},children:e.jsx(J,{userId:s,size:"large",onClick:r})}),e.jsx(qt,{}),e.jsx(S,{sx:{top:"auto",bottom:0,left:0,backgroundColor:"#fff",position:"fixed",width:"100%"},children:e.jsx(k,{sx:{py:2},children:e.jsx(Ie,{multiline:!0,initialMessage:(o=n.state)==null?void 0:o.message})})})]})},us=()=>{const[t,{data:s,isLoading:n}]=Xt(),[r,o]=g.useState(""),[a,i]=g.useState(""),[l,c]=g.useState(""),[u,h]=g.useState(!1),p=C=>{o(C.currentTarget.value),c("")},m=C=>{i(C.currentTarget.value),c("")},d=C=>t({login:Number(r),password:a,captcha:C}),f=C=>{C.preventDefault(),d()},L=C=>d(C),A=()=>h(!1);return g.useEffect(()=>{if(!(s!=null&&s.error))return;({auth:()=>c(s.say),code:()=>{c(s.say),h(!0)}})[s.error]()},[s]),e.jsxs(e.Fragment,{children:[e.jsxs(Y,{component:"form",sx:{margin:"0 auto",mt:8,width:"25ch"},spacing:2,noValidate:!0,autoComplete:"off",onSubmit:f,children:[e.jsx(re,{size:"small",label:e.jsx(x,{id:"LOGIN_TO_ACCOUNT"}),type:"number",value:r,onChange:p,error:!!l}),e.jsx(re,{size:"small",label:e.jsx(x,{id:"PASSWORD"}),type:"password",value:a,onChange:m,error:!!l,helperText:l}),e.jsx(v,{variant:"contained",type:"submit",disabled:n,children:e.jsx(x,{id:"LOGIN_BUTTON"})}),e.jsx(v,{variant:"outlined",disabled:!0,children:e.jsx(x,{id:"REGISTER_BUTTON"})})]}),e.jsx(ve,{open:u,onClose:A,onSubmit:L,refetch:(s==null?void 0:s.error)==="code"})]})},hs=me([{path:M.CHATS,element:e.jsx(Wt,{logged:!0}),children:[{index:!0,element:e.jsx(cs,{})},{path:M.ACQUAINTANCES,element:e.jsx(ls,{})}]},{path:"/",element:e.jsx(K,{logged:!0}),children:[{path:M.CHAT,element:e.jsx(ds,{})}]}]),gs=me([{path:"*",element:e.jsx(K,{}),children:[{path:"*",element:e.jsx(us,{})}]}]),ps=()=>{const s=Se(W)!==null;return e.jsx(rt,{router:s?hs:gs})},ms=()=>t=>s=>(it(s)&&lt("Something went wrong..",{variant:"error"}),t(s)),Le=ot({reducer:{auth:At,settings:Mt,[I.reducerPath]:I.reducer,[E.reducerPath]:E.reducer,[F.reducerPath]:F.reducer,[T.reducerPath]:T.reducer,[N.reducerPath]:N.reducer,[_.reducerPath]:_.reducer},middleware:t=>t().concat(I.middleware,E.middleware,F.middleware,T.middleware,N.middleware,_.middleware,ms)});at.setupListeners(Le.dispatch);ct.createRoot(document.getElementById("root")).render(e.jsx(dt,{store:Le,children:e.jsx(ut,{anchorOrigin:{vertical:"top",horizontal:"right"},autoHideDuration:2e3,action:t=>e.jsx(v,{sx:{color:"inherit"},size:"small",onClick:()=>ht(t),children:e.jsx(gt,{fontSize:"small"})}),children:e.jsx(ps,{})})}));
